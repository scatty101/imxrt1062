cmake_minimum_required(VERSION 3.15.3)

project(drivers VERSION 0.0.0
		LANGUAGES ASM C CXX)

# Lets build a static library with sdk drivers and common config
add_library(${PROJECT_NAME})
add_library(${PROJECT_NAMESPACE}::${PROJECT_NAME} ALIAS ${PROJECT_NAME})

# In sdk folder there are files which were imported from sdk
# Few of them are generated by MCUXpresso based on internal tools, so be careful.
# I am not going to develop clock drivers, it's not worthy to reinvent the wheel

target_include_directories(${PROJECT_NAME}
						PUBLIC	
						${CMAKE_CURRENT_SOURCE_DIR}
						${CMAKE_CURRENT_SOURCE_DIR}/sdk
						${CMAKE_CURRENT_SOURCE_DIR}/sdk/board
						${CMAKE_CURRENT_SOURCE_DIR}/sdk/drivers
						${CMAKE_CURRENT_SOURCE_DIR}/sdk/startup
						${CMAKE_CURRENT_SOURCE_DIR}/sdk/xip

						${CMAKE_CURRENT_SOURCE_DIR}/inc
						)


target_sources(${PROJECT_NAME}
PUBLIC
# Board
# Includes clock configs, dcd (device configuration data,, which contains first clock config etc.)
${CMAKE_CURRENT_SOURCE_DIR}/sdk/board/board.c
${CMAKE_CURRENT_SOURCE_DIR}/sdk/board/clock_config.c
${CMAKE_CURRENT_SOURCE_DIR}/sdk/board/dcd.c
${CMAKE_CURRENT_SOURCE_DIR}/sdk/board/fsl_phy.c
${CMAKE_CURRENT_SOURCE_DIR}/sdk/board/peripherals.c
${CMAKE_CURRENT_SOURCE_DIR}/sdk/board/pin_mux.c

# Drivers
# In fact, i am not going to use, however sdk basic configuration use it, so lets be here
${CMAKE_CURRENT_SOURCE_DIR}/sdk/drivers/fsl_clock.c
${CMAKE_CURRENT_SOURCE_DIR}/sdk/drivers/fsl_common.c
${CMAKE_CURRENT_SOURCE_DIR}/sdk/drivers/fsl_enet.c
${CMAKE_CURRENT_SOURCE_DIR}/sdk/drivers/fsl_flexio_spi.c
${CMAKE_CURRENT_SOURCE_DIR}/sdk/drivers/fsl_flexio.c
${CMAKE_CURRENT_SOURCE_DIR}/sdk/drivers/fsl_gpio.c
${CMAKE_CURRENT_SOURCE_DIR}/sdk/drivers/fsl_lpuart.c
${CMAKE_CURRENT_SOURCE_DIR}/sdk/drivers/fsl_pwm.c
${CMAKE_CURRENT_SOURCE_DIR}/sdk/drivers/fsl_xbara.c
${CMAKE_CURRENT_SOURCE_DIR}/sdk/drivers/fsl_xbarb.c

# Startup
${CMAKE_CURRENT_SOURCE_DIR}/sdk/startup/startup_mimxrt1062.cpp

# External flash cfg
${CMAKE_CURRENT_SOURCE_DIR}/sdk/xip/evkmimxrt1060_flexspi_nor_config.c
${CMAKE_CURRENT_SOURCE_DIR}/sdk/xip/fsl_flexspi_nor_boot.c
)
# Supress missing declalaration warning for generated startup file
set_property(SOURCE ${CMAKE_CURRENT_SOURCE_DIR}/sdk/startup/startup_mimxrt1062.cpp
PROPERTY
COMPILE_FLAGS -Wno-missing-declarations)

# well, we need hardware config
target_link_libraries(${PROJECT_NAME}
PUBLIC
"${PROJECT_NAMESPACE}::hardware")


install(TARGETS ${PROJECT_NAME}
		LIBRARY DESTINATION lib
		ARCHIVE DESTINATION lib)

set(PROJECT_NAME_TESTS drivers_tests)
add_executable(${PROJECT_NAME_TESTS})

target_sources(${PROJECT_NAME_TESTS}
PRIVATE
tests/src/main.cpp)

# Also lets get rid of int main() missing declarations warning
set_property(SOURCE ${CMAKE_CURRENT_SOURCE_DIR}/app/src/main.cpp
PROPERTY
COMPILE_FLAGS -Wno-missing-declarations)

target_link_libraries(${PROJECT_NAME_TESTS}
PRIVATE
"${PROJECT_NAMESPACE}::drivers"
"${PROJECT_NAMESPACE}::tests"
"${PROJECT_NAMESPACE}::utility"
)


install(TARGETS ${PROJECT_NAME}
RUNTIME DESTINATION out)




















